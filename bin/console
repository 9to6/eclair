#!/usr/bin/env ruby
# frozen_string_literal: true

require "eclair"

# You can add fixtures and/or initialization code here to make experimenting
# with your gem easier. You can also use a different console, if you like.

# (If you use this, don't forget to add pry to your Gemfile!)

require "eclair/grid"
Eclair.init_config
Curses.init_screen
Curses.stdscr.timeout = 100
Curses.stdscr.keypad = true
Curses.start_color
Curses.use_default_colors
Curses.crmode
Curses.noecho
Curses.ESCDELAY = 25
trap("INT") { exit }

grid = Eclair::Grid.new

loop do
  case grid.mode
  when :nav, :sel
    Curses.curs_set(0)
    case k = Curses.stdscr.getch
    when Curses::KEY_RESIZE
      grid.resize
    when Curses::KEY_LEFT, Curses::KEY_RIGHT, Curses::KEY_UP, Curses::KEY_DOWN
      grid.move(k)
    when " "
      grid.space
    when 10 # enter
      grid.action
    when "/"
      grid.clear_search
      grid.start_search
    when "n"
      grid.move_next_search
    when "N"
      grid.move_prev_search
    when 27 # escape
      grid.clear_search
    end
  when :search
    Curses.curs_set(1)
    case k = Curses.stdscr.getch
    when Curses::KEY_RESIZE
      grid.resize
    when 10 # enter
      grid.end_search
    when 27 # escape
      grid.clear_search
      grid.end_search
    else
      grid.append_search(k)
    end
  end
end
